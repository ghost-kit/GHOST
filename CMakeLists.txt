cmake_minimum_required(VERSION 2.8.9)
project(GHOST_Shared)

#Options for building
option(BUILD_IO "Build the IO package" OFF )
option(BUILD_DATETIME "Build the DateTime package" OFF )
option(BUILD_CXFORM "Builds the CXFORM package" OFF )
option(USE_FPIC "Use the -fPIC compiler flag to fix various issues" OFF )

if(BUILD_IO)
    option(IO_USE_APP "Use A++ and/or P++ for array storage" OFF)
    option(IO_USE_MPI "Build parallel I/O (Warning: leave this off, it's untested)" OFF)
endif(BUILD_IO)

message(STATUS "Building selected libraries")

if(USE_FPIC)
    set(USE_FPIC true CACHE INTERNAL "")
endif()

### IO LIBRARY ###
if(BUILD_IO)
    message(STATUS "BUILDING IO")
    add_subdirectory(${PROJECT_SOURCE_DIR}/io)

    GET_DIRECTORY_PROPERTY(IO_INCLUDES DIRECTORY io DEFINITION IO_INCLUDES)
    GET_DIRECTORY_PROPERTY(IO_LIBRARIES DIRECTORY io DEFINITION IO_LIBRARIES)

    set(IO_INCLUDE_DIR ${IO_INCLUDES})
    set(IO_LIBRARY_DIR ${PROJECT_BINARY_DIR}/io)

    INCLUDE_DIRECTORIES(${IO_INCLUDE_DIR} ${PROJECT_SOURCE_DIR}/io)
    LINK_DIRECTORIES(${IO_LIBRARY_DIR})

    ##DEBUG##
    message(STATUS "IO include: ${IO_INCLUDE_DIR}")
    message(STATUS "IO libraries: ${IO_LIBRARY_DIR}")
endif()


### DATETIME LIBRARY ###
if(BUILD_DATETIME)
    message(STATUS "BUILDING DATETIME")
    add_subdirectory(${PROJECT_SOURCE_DIR}/DateTime)

    GET_DIRECTORY_PROPERTY(DATETIME_INCLUDES DIRECTORY DateTime DEFINITION DATETIME_INCLUDES)
    GET_DIRECTORY_PROPERTY(DATETIME_LIBRARIES DIRECTORY DateTime DEFINITION DATETIME_LIBRARIES)

    set(DATETIME_INCLUDE_DIR ${DATETIME_INCLUDES} ${PROJECT_SOURCE_DIR}/DateTime)
    set(DATETIME_LIBRARY_DIR ${PROJECT_BINARY_DIR}/DateTime)

    INCLUDE_DIRECTORIES(${DATETIME_INCLUDE_DIR})
    LINK_DIRECTORIES(${DATETIME_LIBRARY_DIR})

    ##DEBUG##
    message(STATUS "DateTime include: ${DATETIME_INCLUDE_DIR}")
    message(STATUS "DateTime include: ${DATETIME_LIBRARY_DIR}")
endif()

### CXFORM LIBRARY ###
if(BUILD_CXFORM)
    message(STATUS "BUILDING CXFORM")
    add_subdirectory(${PROJECT_SOURCE_DIR}/cxform)

    GET_DIRECTORY_PROPERTY(CXFORM_INCLUDES DIRECTORY cxform DEFINITION CXFORM_INCLUDES)
    GET_DIRECTORY_PROPERTY(CXFORM_LIBRARIES DIRECTORY cxform DEFINITION CXFORM_LIBRARIES)

    set(CXFORM_INCLUDE_DIR ${PROJECT_SOURCE_DIR}/cxform)
    set(CXFORM_LIBRARY_DIR ${PROJECT_BINARY_DIR}/cxform)

    INCLUDE_DIRECTORIES(${CXFORM_INCLUDE_DIR} ${PROJECT_SOURCE_DIR}/cxform)
    LINK_DIRECTORIES(${CXFORM_LIBRARY_DIR})

    ##DEBUG##
    message(STATUS "cxform include: ${CXFORM_INCLUDE_DIR}")
    message(STATUS "cxform libraries: ${CXFORM_LIBRARY_DIR}")
endif()

set(SHARED_INCLUDE_DIR ${IO_INCLUDE_DIR} ${DATETIME_INCLUDE_DIR} ${CXFORM_INCLUDE_DIR} CACHE INTERNAL "")
set(SHARED_LIBRARY_DIR ${IO_LIBRARY_DIR} ${DATETIME_LIBRARY_DIR} ${CXFORM_LIBRARY_DIR} CACHE INTERNAL "")
set(SHARED_LIBRARIES ${IO_LIBRARIES} ${DATETIME_LIBRARIES} ${CXFORM_LIBRARIES} CACHE INTERNAL "")

